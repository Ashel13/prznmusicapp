<!DOCTYPE html>
<html>
<head>
    <title>Streamer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #121212; color: white; font-family: sans-serif; margin: 0; padding-bottom: 120px; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; padding: 15px; background: #181818; border-bottom: 1px solid #333; }
        .user-tag { color: #1DB954; font-weight: bold; }
        .logout { color: #888; text-decoration: none; font-size: 12px; border: 1px solid #444; padding: 5px 10px; border-radius: 15px; }

        /* Search Bar Area */
        .search-container { display: flex; padding: 15px; gap: 10px; position: sticky; top: 0; background: #121212; z-index: 100; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: none; background: #2a2a2a; color: white; font-size: 16px; outline: none; }
        .go-btn { background: #1DB954; color: black; border: none; border-radius: 8px; padding: 0 20px; font-weight: bold; cursor: pointer; }

        /* Song List */
        .list { padding: 0 15px; }
        .song-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #2a2a2a; cursor: pointer; }
        .song-item:active { background: #222; }
        .song-item img { width: 50px; height: 50px; border-radius: 4px; margin-right: 15px; object-fit: cover; }
        .song-info { flex: 1; overflow: hidden; }
        .song-info h4 { margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 14px; }
        .song-info p { margin: 3px 0 0; font-size: 12px; color: #b3b3b3; }

        /* Player Bar */
        .player-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #181818; padding: 15px; border-top: 1px solid #282828; }
        audio { width: 100%; height: 35px; outline: none; }
        
        /* Loading Spinner */
        #loading { text-align: center; color: #888; padding: 20px; display: none; }
    </style>
</head>
<body>

    <div class="header">
        <span class="user-tag">ðŸ‘¤ {{ user }}</span>
        <a href="/logout" class="logout">Log Out</a>
    </div>

    <div class="search-container">
        <input type="text" id="query" placeholder="Song or Artist...">
        <button class="go-btn" onclick="doSearch()">GO</button>
    </div>

    <div id="loading">Searching...</div>
    <div id="searchResults" class="list"></div>

    <div class="player-bar">
        <audio id="audioPlayer" controls autoplay></audio>
    </div>

    <script>
        async function doSearch() {
            let q = document.getElementById('query').value;
            if(!q) return;
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('searchResults').innerHTML = '';

            try {
                let res = await fetch('/search?q=' + encodeURIComponent(q));
                let data = await res.json();
                renderList(data);
            } catch (err) {
                alert("Search failed. Try again.");
            }
            
            // Hide loading
            document.getElementById('loading').style.display = 'none';
        }

        function renderList(songs) {
            let html = '';
            if(songs.length === 0) html = '<p style="text-align:center; color:#555; margin-top:20px;">No results found.</p>';
            
            songs.forEach(song => {
                html += `
                <div class="song-item" onclick="play('${song.videoId}')">
                    <img src="${song.thumbnail}">
                    <div class="song-info">
                        <h4>${song.title}</h4>
                        <p>${song.artist}</p>
                    </div>
                </div>`;
            });
            document.getElementById('searchResults').innerHTML = html;
        }

        function play(id) {
            let player = document.getElementById('audioPlayer');
            player.src = '/get_stream?id=' + id;
            player.play().catch(e => console.log("Playback error:", e));
        }
        
        // Allow pressing "Enter" to search
        document.getElementById("query").addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                doSearch();
            }
        });
    </script>
</body>
</html>
